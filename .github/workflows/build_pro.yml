name: ğŸ’ Ultimate Liquid Glass Build (2026)

on:
  push:
    branches: [ "main" ]
    paths:
      - 'frontend/**'  # ÙŠØ´ØªØºÙ„ Ø¨Ø³ Ù„Ùˆ Ø¹Ø¯Ù„Øª ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚

# Ø®Ø§ØµÙŠØ© Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ùˆ Ø±ÙØ¹Øª ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ ÙÙˆØ±Ø§Ù‹ (ØªÙˆÙÙŠØ± Ù…ÙˆØ§Ø±Ø¯)
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build-and-optimize:
    name: ğŸš€ Build, Shrink & Obfuscate
    runs-on: ubuntu-latest
    
    defaults:
      run:
        working-directory: ./frontend

    steps:
      # 1. Ø³Ø­Ø¨ Ø§Ù„ÙƒÙˆØ¯
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      # 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¦Ø© Ø¬Ø§ÙØ§ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©
      - name: â˜• Setup Java 17 (Zulu)
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'
          cache: 'gradle' # ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒØ§Ø´ Ù„Ù„Ø¬Ø±Ø§Ø¯Ù„

      # 3. Ø¥Ø¹Ø¯Ø§Ø¯ ÙÙ„Ø§ØªØ± (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø­Ø¯Ø«)
      - name: âš¡ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          cache: true # ØªÙØ¹ÙŠÙ„ ÙƒØ§Ø´ Ø§Ù„ÙÙ„Ø§ØªØ±

      # 4. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ÙØ´Ù„)
      # Ù„Ùˆ Ù†Ø³ÙŠØª ØªØ±ÙØ¹ background.jpgØŒ Ø§Ù„Ø®Ø·ÙˆØ© Ø¯ÙŠ Ù‡ØªØ¹Ù…Ù„ Ù…Ù„Ù ÙˆÙ‡Ù…ÙŠ Ø¹Ø´Ø§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØªØ¨Ù†ÙŠ
      - name: ğŸ›¡ï¸ Check & Fix Assets
        run: |
          mkdir -p assets/images
          if [ ! -f assets/images/background.jpg ]; then
            echo "âš ï¸ Background missing! Creating a dummy placeholder..."
            touch assets/images/background.jpg
          fi

      # 5. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
      - name: ğŸ“¦ Install Dependencies
        run: flutter pub get

      # 6. ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©)
      - name: ğŸ” Analyze Code Quality
        run: flutter analyze --no-fatal-infos

      # 7. Ø¨Ù†Ø§Ø¡ Ù…Ù„Ù APK Ù…Ø¹ Ø§Ù„ØªØ´ÙÙŠØ± ÙˆØ§Ù„Ø¶ØºØ· (The Monster Command)
      - name: ğŸ› ï¸ Build Optimized APK
        run: |
          flutter build apk --release \
            --obfuscate \
            --split-debug-info=./debug-info \
            --no-tree-shake-icons

      # 8. Ø¨Ù†Ø§Ø¡ Ù…Ù„Ù AAB (Ù„Ù„Ù…ØªØ¬Ø± Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)
      - name: ğŸ“¦ Build App Bundle (AAB)
        run: flutter build appbundle --release --obfuscate --split-debug-info=./debug-info

      # 9. Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„Ù Ù„Ø§Ø³Ù… Ù…Ù…ÙŠØ²
      - name: ğŸ·ï¸ Rename Artifacts
        run: |
          mv build/app/outputs/flutter-apk/app-release.apk ./LiquidGlass-Ultra-v1.apk
          mv build/app/outputs/bundle/release/app-release.aab ./LiquidGlass-Store-v1.aab

      # 10. Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
      - name: ğŸ“¤ Upload High-Performance APK
        uses: actions/upload-artifact@v4
        with:
          name: Liquid-Glass-Ultra-App
          path: |
            frontend/LiquidGlass-Ultra-v1.apk
            frontend/LiquidGlass-Store-v1.aab
Ultimate

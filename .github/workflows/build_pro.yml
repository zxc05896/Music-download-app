name: LiquidSnap_Master_Build

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # ÙŠØªÙŠØ­ Ù„Ùƒ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø£ÙŠØ¶Ø§

jobs:
  build_apk:
    name: ğŸ—ï¸ Advanced Flutter Build
    runs-on: ubuntu-latest
    
    # ØªØ­Ø¯ÙŠØ¯ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¹Ù…Ù„ Ù„Ø£Ù† ÙƒÙˆØ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¯Ø§Ø®Ù„ ÙÙˆÙ„Ø¯Ø± frontend
    defaults:
      run:
        working-directory: ./frontend

    steps:
      # 1. Ø³Ø­Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† GitHub
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      # 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ø§ÙØ§ (Ù†Ø³Ø®Ø© 17 Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø© Ù„Ø¹Ø§Ù… 2026)
      - name: â˜• Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'
          cache: 'gradle'

      # 3. Ø¥Ø¹Ø¯Ø§Ø¯ ÙÙ„Ø§ØªØ±
      - name: âš¡ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          cache: true

      # 4. Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª)
      - name: ğŸ› ï¸ Auto-Fix Environment
        run: |
          mkdir -p assets/images
          if [ ! -f assets/images/background.jpg ]; then
            touch assets/images/background.jpg
          fi

      # 5. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
      - name: ğŸ“¦ Install Dependencies
        run: flutter pub get

      # 6. Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù†Ø³Ø®Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø´ÙØ±Ø© ÙˆÙ…Ø¶ØºÙˆØ·Ø©)
      # --obfuscate: ØªÙ…Ù†Ø¹ Ø£ÙŠ Ø­Ø¯ Ù…Ù† Ø³Ø±Ù‚Ø© ÙƒÙˆØ¯Ùƒ Ø£Ùˆ ÙÙƒÙ‡
      # --split-debug-info: ØªÙ‚Ù„Ù„ Ø­Ø¬Ù… Ø§Ù„Ù€ APK Ø¨Ø´ÙƒÙ„ Ù…Ù„Ø­ÙˆØ¸
      - name: ğŸ› ï¸ Build Optimized APK
        run: |
          flutter build apk --release \
            --obfuscate \
            --split-debug-info=./debug-info \
            --no-tree-shake-icons

      # 7. ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ØªØ­Ù…ÙŠÙ„
      - name: ğŸ·ï¸ Prepare Artifact
        run: |
          mv build/app/outputs/flutter-apk/app-release.apk ../LiquidSnap_Ultra_2026.apk

      # 8. Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø³ØªØ¬Ø¯Ù‡ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Actions)
      - name: ğŸ“¤ Upload Production APK
        uses: actions/upload-artifact@v4
        with:
          name: LiquidSnap_Final_Build
          path: LiquidSnap_Ultra_2026.apk
          retention-days: 7 # Ø§Ù„Ù…Ù„Ù Ù‡ÙŠÙØ¶Ù„ Ù…ØªØ§Ø­ Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù…Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹
